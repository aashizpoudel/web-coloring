(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const z=(n,e=[])=>{const t=document.createElement("div");t.className="flex flex-col items-center justify-center min-h-screen p-4 space-y-8 bg-gradient-to-br from-orange-50 via-pink-50 to-purple-50 relative fade-in",t.innerHTML=`
        <div class="absolute top-20 left-20 w-64 h-64 bg-orange-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-pulse"></div>
        <div class="absolute bottom-20 right-20 w-64 h-64 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-pulse" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/2 left-1/2 w-64 h-64 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-pulse" style="animation-delay: 2s;"></div>
    `;const i=document.createElement("div");i.className="relative z-10 w-full max-w-3xl p-8 bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl border border-white/50 text-center";const s=document.createElement("h1");s.className="text-4xl font-bold text-stone-800 mb-2",s.innerText="üé® Coloring Book";const o=document.createElement("p");o.className="text-stone-600 mb-8",o.innerText="Choose a coloring page to start creating!";const d=document.createElement("div");d.className="mb-8";const b=document.createElement("h2");b.className="text-sm font-bold text-stone-400 uppercase tracking-widest mb-4",b.innerText="Select a Coloring Page";const c=document.createElement("div");c.className="grid grid-cols-2 md:grid-cols-4 gap-4",e.forEach(f=>{const x=document.createElement("button");x.className="group relative aspect-square rounded-2xl overflow-hidden border-2 border-stone-200 hover:border-orange-400 hover:shadow-lg transition-all hover:scale-[1.02]",x.innerHTML=`
            <img src="${f.src}" alt="${f.name}" class="w-full h-full object-cover bg-white" />
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center pb-3">
                <span class="text-white font-bold text-sm">${f.name}</span>
            </div>
        `,x.onclick=()=>n(f.src),c.appendChild(x)}),d.appendChild(b),d.appendChild(c);const l=document.createElement("div");l.className="flex items-center gap-3 my-6",l.innerHTML=`
        <div class="flex-1 h-px bg-stone-200"></div>
        <span class="text-xs text-stone-400 uppercase tracking-widest">or</span>
        <div class="flex-1 h-px bg-stone-200"></div>
    `;const h=document.createElement("div");h.className="space-y-3";const y=document.createElement("h2");y.className="text-sm font-bold text-stone-400 uppercase tracking-widest mb-3",y.innerText="Upload Your Own";const a=document.createElement("input");a.type="file",a.accept="image/*",a.className="hidden",a.id="custom-file-input";const m=document.createElement("button");m.className="w-full py-4 px-6 bg-gradient-to-r from-stone-100 to-stone-200 rounded-xl text-stone-700 font-bold text-lg border-2 border-dashed border-stone-300 hover:border-orange-400 hover:bg-orange-50 hover:text-orange-600 transition-all flex items-center justify-center gap-2",m.innerHTML=`
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        Upload Custom Line Art
    `,m.onclick=()=>a.click(),a.onchange=f=>{if(f.target.files&&f.target.files[0]){const x=new FileReader;x.onload=w=>{n(w.target.result)},x.readAsDataURL(f.target.files[0])}},h.appendChild(y),h.appendChild(a),h.appendChild(m);const C=document.createElement("p");return C.className="text-xs text-stone-400 mt-6",C.innerText="Tip: Use black & white line art images for best results!",i.appendChild(s),i.appendChild(o),i.appendChild(d),i.appendChild(l),i.appendChild(h),i.appendChild(C),t.appendChild(i),t};function R(n,e={}){const{threshold:t=200,dilationRadius:i=1}=e,s=n.naturalWidth||n.width,o=n.naturalHeight||n.height,d=document.createElement("canvas"),b=d.getContext("2d",{willReadFrequently:!0});d.width=s,d.height=o,b.drawImage(n,0,0);const c=b.getImageData(0,0,s,o),l=c.data;for(let h=0;h<l.length;h+=4){const a=.299*l[h]+.587*l[h+1]+.114*l[h+2]<t?0:255;l[h]=a,l[h+1]=a,l[h+2]=a,l[h+3]=255}if(i>0){const h=new Uint8ClampedArray(l.length);h.set(l);const y=[];for(let a=-i;a<=i;a++)for(let m=-i;m<=i;m++)m*m+a*a<=i*i&&y.push({dx:m,dy:a});for(let a=0;a<o;a++)for(let m=0;m<s;m++){const C=(a*s+m)*4;if(l[C]===0)for(const{dx:f,dy:x}of y){const w=m+f,E=a+x;if(w>=0&&w<s&&E>=0&&E<o){const L=(E*s+w)*4;h[L]=0,h[L+1]=0,h[L+2]=0}}}for(let a=0;a<l.length;a++)l[a]=h[a]}return b.putImageData(c,0,0),{dataURL:d.toDataURL("image/png"),boundaryData:new Uint8ClampedArray(l),width:s,height:o}}const H="/audio/bubble_pop.mp3";class O{constructor(e,t,i={}){this.container=e,this.currentColor=i.initialColor||"#000000",this.onUpdate=i.onUpdate,this.mode="fill",this.brushSize=10,this.isDrawing=!1,this.isPanning=!1,this.zoom=1,this.pan={x:0,y:0},this.lastTouchDist=0,this.startPan={x:0,y:0},this.lineArtData=null,this.lineArtWidth=0,this.lineArtHeight=0,this.init(t,i.initialDrawingData)}init(e,t){this.img=new Image,this.img.crossOrigin="anonymous",this.img.src=e,this.img.onload=()=>{console.log("Original image loaded, processing line art...");const i=R(this.img,{threshold:200,dilationRadius:0});this.lineArtData=i.boundaryData,this.lineArtWidth=i.width,this.lineArtHeight=i.height;const s=i.dataURL;console.log(`Line art processed: ${this.lineArtWidth}x${this.lineArtHeight}`),this.createEditorDOM(s),t&&this.loadDrawingData(t),this.setupEvents(),this.fitToScreen(),window.addEventListener("resize",()=>this.fitToScreen())}}loadDrawingData(e){const t=new Image;t.src=e,t.onload=()=>{this.ctx.drawImage(t,0,0)}}getDrawingData(){return this.canvas.toDataURL("image/png")}createEditorDOM(e){this.wrapper=document.createElement("div"),this.wrapper.className="relative w-full h-full overflow-hidden bg-stone-100 touch-none select-none",this.innerContainer=document.createElement("div"),this.innerContainer.style.position="absolute",this.innerContainer.style.width=this.lineArtWidth+"px",this.innerContainer.style.height=this.lineArtHeight+"px",this.innerContainer.style.transformOrigin="0 0",this.innerContainer.style.willChange="transform",this.innerContainer.style.backfaceVisibility="hidden",this.innerContainer.style.boxShadow="0 20px 50px rgba(0,0,0,0.1)",this.canvas=document.createElement("canvas"),this.canvas.width=this.lineArtWidth,this.canvas.height=this.lineArtHeight,this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.touchAction="none",this.canvas.style.imageRendering="auto",this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high",this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.overlayImg=document.createElement("img"),this.overlayImg.src=e,this.overlayImg.style.position="absolute",this.overlayImg.style.top="0",this.overlayImg.style.left="0",this.overlayImg.style.width="100%",this.overlayImg.style.height="100%",this.overlayImg.style.pointerEvents="none",this.overlayImg.style.mixBlendMode="multiply",this.overlayImg.style.imageRendering="auto",this.overlayImg.style.webkitFontSmoothing="antialiased",this.cursorPreview=document.createElement("div"),this.cursorPreview.className="pointer-events-none fixed border border-stone-800 rounded-full z-50 hidden",this.cursorPreview.style.transform="translate(-50%, -50%)",this.cursorPreview.style.boxShadow="0 0 4px rgba(255, 255, 255, 0.8), inset 0 0 2px rgba(255, 255, 255, 0.8)",this.innerContainer.appendChild(this.canvas),this.innerContainer.appendChild(this.overlayImg),this.wrapper.appendChild(this.innerContainer),this.container.appendChild(this.cursorPreview),this.container.appendChild(this.wrapper)}fitToScreen(){const e=this.wrapper.getBoundingClientRect(),t=40,i=e.width-t,s=e.height-t,o=i/this.lineArtWidth,d=s/this.lineArtHeight;this.zoom=Math.min(o,d,.9),this.pan.x=(e.width-this.lineArtWidth*this.zoom)/2,this.pan.y=(e.height-this.lineArtHeight*this.zoom)/2,this.updateTransform()}updateTransform(){this.innerContainer.style.transform=`translate(${this.pan.x}px, ${this.pan.y}px) scale(${this.zoom})`,this.updateCursorSize()}updateCursorSize(){if((this.mode==="brush"||this.mode==="eraser")&&this.cursorPreview){const e=this.brushSize*this.zoom;this.cursorPreview.style.width=e+"px",this.cursorPreview.style.height=e+"px",this.cursorPreview.style.borderRadius="50%",this.mode==="eraser"?(this.cursorPreview.style.borderColor="#333",this.cursorPreview.style.backgroundColor="rgba(255, 255, 255, 0.8)"):this.setColor(this.currentColor)}}initAudio(){this.unfillAudio=this.fillAudio=new Audio(H),this.unfillAudio.volume=.5,this.playFillSound=()=>{const e=this.fillAudio.cloneNode();e.volume=.5,e.play().catch(()=>{})},this.playUnfillSound=()=>{const e=this.unfillAudio.cloneNode();e.volume=.5,e.play().catch(()=>{})}}setupEvents(){this.initAudio(),this.wrapper.addEventListener("contextmenu",e=>e.preventDefault()),this.wrapper.addEventListener("wheel",e=>this.handleWheel(e),{passive:!1}),this.wrapper.addEventListener("pointerdown",e=>this.handleStart(e)),window.addEventListener("pointermove",e=>this.handleMove(e)),window.addEventListener("pointerup",e=>this.handleEnd(e)),this.wrapper.addEventListener("pointerenter",()=>{(this.mode==="brush"||this.mode==="eraser")&&this.cursorPreview.classList.remove("hidden")}),this.wrapper.addEventListener("pointerleave",()=>{this.cursorPreview.classList.add("hidden")}),this.wrapper.addEventListener("touchstart",e=>{e.touches.length>1&&e.preventDefault()},{passive:!1})}handleWheel(e){e.preventDefault();const t=-Math.sign(e.deltaY),s=Math.max(.1,Math.min(5,this.zoom+t*.1));if(s===this.zoom)return;const o=this.wrapper.getBoundingClientRect(),d=e.clientX-o.left,b=e.clientY-o.top,c=(d-this.pan.x)/this.zoom,l=(b-this.pan.y)/this.zoom;this.zoom=s,this.pan.x=d-c*this.zoom,this.pan.y=b-l*this.zoom,this.updateTransform()}getCoords(e){const t=this.canvas.getBoundingClientRect(),i=this.canvas.width/t.width,s=this.canvas.height/t.height;return{x:(e.clientX-t.left)*i,y:(e.clientY-t.top)*s}}handleStart(e){if(e.pointerType==="touch"&&!e.isPrimary)return;if(this.mode==="pan"||e.button===1){this.isPanning=!0,this.startPan={x:e.clientX-this.pan.x,y:e.clientY-this.pan.y},this.wrapper.style.cursor="grabbing";return}const{x:t,y:i}=this.getCoords(e);if(this.isDrawing=!0,this.mode==="fill"){const s=e.button===2;this.floodFill(t,i,s?"#FFFFFF":this.currentColor,s),this.isDrawing=!1}else e.button!==2&&(this.ctx.beginPath(),this.ctx.moveTo(t,i),this.ctx.strokeStyle=this.mode==="eraser"?"#FFFFFF":this.currentColor,this.ctx.lineWidth=this.brushSize)}handleMove(e){if((this.mode==="brush"||this.mode==="eraser")&&this.cursorPreview&&(this.cursorPreview.style.top=e.clientY+"px",this.cursorPreview.style.left=e.clientX+"px"),this.isPanning){this.pan.x=e.clientX-this.startPan.x,this.pan.y=e.clientY-this.startPan.y,this.updateTransform();return}if(!this.isDrawing||this.mode==="fill")return;const{x:t,y:i}=this.getCoords(e);this.ctx.lineTo(t,i),this.ctx.stroke()}handleEnd(){this.isPanning=!1,this.isDrawing=!1,this.mode==="pan"?this.wrapper.style.cursor="grab":this.mode==="brush"||this.mode==="eraser"?this.wrapper.style.cursor="none":this.mode,this.ctx.closePath(),this.onUpdate&&this.onUpdate()}setColor(e){this.currentColor=e,this.cursorPreview&&(this.cursorPreview.style.borderColor=e==="#FFFFFF"?"#000000":e,this.cursorPreview.style.backgroundColor=e+"20")}setBrushSize(e){this.brushSize=e,this.updateCursorSize()}setMode(e){this.mode=e,this.wrapper.style.touchAction="none",e==="brush"||e==="eraser"?(this.wrapper.style.cursor="none",this.cursorPreview&&(this.cursorPreview.classList.remove("hidden"),this.updateCursorSize())):e==="fill"?(this.wrapper.style.cursor="crosshair",this.cursorPreview&&this.cursorPreview.classList.add("hidden")):e==="pan"&&(this.wrapper.style.cursor="grab",this.cursorPreview&&this.cursorPreview.classList.add("hidden"))}isLineBoundary(e,t){if(!this.lineArtData)return!1;const i=Math.floor(e),s=Math.floor(t);if(i<0||i>=this.lineArtWidth||s<0||s>=this.lineArtHeight)return!0;const o=(s*this.lineArtWidth+i)*4;return this.lineArtData[o]===0}floodFill(e,t,i,s=!1){const o=this.canvas.width,d=this.canvas.height;if(e=Math.round(e),t=Math.round(t),this.isLineBoundary(e,t))return;const b=this.ctx.getImageData(0,0,o,d),c=b.data,l=(t*o+e)*4,h=c[l],y=c[l+1],a=c[l+2],m=c[l+3],C=parseInt(i.slice(1,3),16),f=parseInt(i.slice(3,5),16),x=parseInt(i.slice(5,7),16);if(h===C&&y===f&&a===x&&m===255)return;const w=new Uint8Array(o*d),E=32,L=v=>Math.abs(c[v]-h)<=E&&Math.abs(c[v+1]-y)<=E&&Math.abs(c[v+2]-a)<=E,k=[],T=[[e,t]];for(;T.length>0;){const[v,g]=T.shift();if(v<0||v>=o||g<0||g>=d)continue;const A=g*o+v;if(w[A])continue;w[A]=1;const S=A*4;this.isLineBoundary(v,g)||L(S)&&(k.push({pos:S,origR:c[S],origG:c[S+1],origB:c[S+2]}),T.push([v+1,g],[v-1,g],[v,g+1],[v,g-1]))}if(k.length!==0){s?this.playUnfillSound():this.playFillSound();for(const v of k){const{pos:g}=v;c[g]=C,c[g+1]=f,c[g+2]=x,c[g+3]=255}this.ctx.putImageData(b,0,0)}}getImageDataURL(){const e=document.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height;const t=e.getContext("2d");return t.fillStyle="#FFFFFF",t.fillRect(0,0,e.width,e.height),t.drawImage(this.canvas,0,0),t.globalCompositeOperation="multiply",t.drawImage(this.overlayImg,0,0),e.toDataURL("image/png")}}const u={audio:null,volume:.5,currentTrack:null,tracks:{},init(n){this.currentTrack="default",this.tracks={default:n},this.audio=new Audio(n),this.audio.loop=!0,this.audio.volume=this.volume},addTrack(n,e){this.tracks[n]=e},switchTrack(n){if(n==="none"){this.audio&&(this.audio.pause(),this.audio.currentTime=0),this.currentTrack="none";return}if(!this.tracks[n])return;const e=this.audio&&!this.audio.paused,t=this.audio?this.audio.muted:!1;this.audio&&(this.audio.pause(),this.audio.currentTime=0),this.audio=new Audio(this.tracks[n]),this.audio.loop=!0,this.audio.volume=this.volume,this.audio.muted=t,this.currentTrack=n,(e||this.currentTrack!=="none")&&this.play()},getCurrentTrack(){return this.currentTrack},getTrackNames(){return Object.keys(this.tracks)},play(){this.currentTrack!=="none"&&this.audio&&this.audio.play().catch(n=>console.log("Audio play failed (user interaction needed):",n))},pause(){this.audio&&this.audio.pause()},toggle(){this.audio.paused?this.play():this.pause()},setVolume(n){this.volume=Math.max(0,Math.min(1,n)),this.audio&&(this.audio.volume=this.volume)},getVolume(){return this.volume},volumeUp(){this.setVolume(this.volume+.1)},volumeDown(){this.setVolume(this.volume-.1)},mute(){return this.audio?(this.audio.muted=!this.audio.muted,this.audio.muted):!1},isMuted(){return this.audio?this.audio.muted:!1}},D=document.querySelector("#app");let P={music:[],images:[]};const U=(n,e)=>{try{const t={imageSrc:n,drawingData:e.getDrawingData(),timestamp:Date.now(),audio:{track:u.getCurrentTrack(),paused:u.audio?u.audio.paused:!0,muted:u.isMuted(),volume:u.getVolume()}};localStorage.setItem("vibe_coloring_state",JSON.stringify(t))}catch(t){console.warn("Save failed",t)}},B=()=>{try{const n=localStorage.getItem("vibe_coloring_state");return n?JSON.parse(n):null}catch{return null}},_=["#e63946","#f4a261","#e9c46a","#2a9d8f","#264653","#a855f7","#ec4899","#22c55e"],I=(n=P.images)=>{D.innerHTML="",D.appendChild(z(q,n))},q=n=>{D.innerHTML=`
    <div class="h-screen w-full flex flex-col items-center justify-center bg-orange-50 space-y-6">
      <div class="relative w-24 h-24">
        <div class="absolute inset-0 border-4 border-orange-200 rounded-full animate-ping"></div>
        <div class="absolute inset-0 border-4 border-orange-500 rounded-full animate-spin border-t-transparent"></div>
      </div>
      <p class="text-stone-600  text-xl animate-pulse">Loading coloring page...</p>
    </div>
  `;const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{console.log("Image loaded successfully"),N(n,_)},e.onerror=t=>{console.error("Failed to load image:",t),alert("Failed to load image. Please try again."),I()},e.src=n},N=(n,e=null)=>{D.innerHTML="";const t=document.createElement("div");t.className="h-screen w-full flex flex-col bg-stone-100 overflow-hidden fade-in";const i=document.createElement("header");i.className="h-14 bg-white shadow-sm flex items-center justify-between px-6 z-10 flex-shrink-0",i.innerHTML=`
    <h1 class=" font-bold text-xl text-stone-800">Coloring Book</h1>
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-3 bg-stone-100 rounded-lg px-3 py-1.5">
        <select id="music-selector" class="bg-transparent text-sm text-stone-600 outline-none cursor-pointer pr-1" title="Select Music">
          ${P.music.map(r=>`<option value="${r.id}">${r.name}</option>`).join("")}
        </select>
        <div class="w-px h-4 bg-stone-300"></div>
        <button id="mute-btn" class="text-lg hover:scale-110 transition-transform" title="Mute/Unmute">üîä</button>
        <input type="range" id="volume-slider" min="0" max="100" value="50" 
          class="w-20 h-1.5 bg-stone-300 rounded-lg appearance-none cursor-pointer accent-orange-500"
          title="Volume">
      </div>
      <div class="flex gap-2">
        <button id="save-btn" class="px-4 py-2 bg-orange-100 text-orange-700 rounded-lg font-bold text-sm hover:bg-orange-200">Save Art</button>
        <button id="home-btn" class="px-4 py-2 text-stone-500 hover:text-stone-800">Exit</button>
      </div>
    </div>
  `;const s=document.createElement("div");s.className="flex-1 flex overflow-hidden p-4 gap-4";const o=document.createElement("div");o.className="w-72 bg-white rounded-2xl shadow-[0_4px_20px_rgba(0,0,0,0.08)] flex flex-col p-4 z-10 overflow-y-auto";const d=document.createElement("div");d.className="flex flex-col gap-3 pb-4 border-b border-stone-100",d.innerHTML=`
        <div class="flex items-center gap-2">
            <button class="tool-btn active flex items-center justify-center w-10 h-10 rounded-xl bg-orange-50 hover:bg-orange-100 transition-colors" data-mode="fill" title="Fill">
                <span class="text-xl">ü™£</span>
            </button>
            <button class="tool-btn flex items-center justify-center w-10 h-10 rounded-xl bg-stone-50 hover:bg-stone-100 transition-colors" data-mode="brush" title="Brush">
                <span class="text-xl">üñåÔ∏è</span>
            </button>
            <button class="tool-btn flex items-center justify-center w-10 h-10 rounded-xl bg-stone-50 hover:bg-stone-100 transition-colors" data-mode="pan" title="Pan/Zoom">
                <span class="text-xl">‚úã</span>
            </button>
            <button class="tool-btn flex items-center justify-center w-10 h-10 rounded-xl bg-stone-50 hover:bg-stone-100 transition-colors" data-mode="eraser" title="Eraser">
                <span class="text-xl">üßº</span>
            </button>
        </div>
        <div class="flex items-center gap-2">
            <span class="text-xs text-stone-400">Size</span>
            <input type="range" id="brush-size" min="2" max="40" value="10" 
                class="flex-1 h-1.5 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-orange-500">
            <span id="brush-size-value" class="text-xs text-stone-500 w-6 text-right">10</span>
        </div>
    `;const b=["#e63946","#f4a261","#e9c46a","#2a9d8f","#264653","#a855f7","#ec4899","#22c55e","#3b82f6","#8b5cf6","#06b6d4","#84cc16"],c=document.createElement("div");c.className="py-4 border-b border-stone-100",c.innerHTML='<div class="text-xs text-orange-500 font-bold mb-3">Palette</div>';const l=document.createElement("div");l.className="grid grid-cols-6 gap-2",b.forEach(r=>{const p=document.createElement("button");p.className="color-btn w-8 h-8 rounded-full border-2 border-white shadow-sm transition-all hover:scale-110",p.style.backgroundColor=r,p.dataset.color=r,l.appendChild(p)}),c.appendChild(l);const h=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac","#ffe0bd","#6b4423","#a57449","#d4a574","#e8c4a2","#fad4c0","#ffe5d4"],y=document.createElement("div");y.className="py-4 border-b border-stone-100",y.innerHTML='<div class="text-xs text-orange-500 font-bold mb-3">Skin tone</div>';const a=document.createElement("div");a.className="grid grid-cols-6 gap-2",h.forEach(r=>{const p=document.createElement("button");p.className="color-btn w-8 h-8 rounded-full border-2 border-white shadow-sm transition-all hover:scale-110",p.style.backgroundColor=r,p.dataset.color=r,a.appendChild(p)}),y.appendChild(a);const m=["#000000","#4a3728","#8b4513","#d2691e","#ff8c00","#daa520","#f5deb3","#c0c0c0","#808080","#2f1810","#5c3317","#a0522d"],C=document.createElement("div");C.className="py-4",C.innerHTML='<div class="text-xs text-orange-500 font-bold mb-3">Hair color</div>';const f=document.createElement("div");f.className="grid grid-cols-6 gap-2",m.forEach(r=>{const p=document.createElement("button");p.className="color-btn w-8 h-8 rounded-full border-2 border-white shadow-sm transition-all hover:scale-110",p.style.backgroundColor=r,p.dataset.color=r,f.appendChild(p)}),C.appendChild(f),o.appendChild(d),o.appendChild(c),o.appendChild(y),o.appendChild(C);const x=document.createElement("div");x.className="flex-1 relative bg-white rounded-2xl shadow-[0_4px_20px_rgba(0,0,0,0.08)] cursor-crosshair overflow-hidden",s.appendChild(o),s.appendChild(x),t.appendChild(i),t.appendChild(s),D.appendChild(t);const w=new O(x,n,{initialColor:b[0],initialDrawingData:e,onUpdate:()=>U(n,w)});t.querySelector("#home-btn").onclick=()=>{localStorage.removeItem("vibe_coloring_state"),location.reload()},t.querySelector("#save-btn").onclick=()=>{const r=document.createElement("a");r.download="my-coloring.png",r.href=w.getImageDataURL(),r.click()},t.querySelectorAll(".tool-btn").forEach(r=>{r.onclick=p=>{const F=p.currentTarget;t.querySelectorAll(".tool-btn").forEach(M=>{M.classList.remove("bg-orange-100","border-2","border-orange-400"),M.classList.add("bg-stone-50")}),F.classList.remove("bg-stone-50"),F.classList.add("bg-orange-100","border-2","border-orange-400"),w.setMode(F.dataset.mode)}});const E=r=>{t.querySelectorAll(".color-btn").forEach(p=>{p.classList.remove("ring-2","ring-orange-400","ring-offset-2","scale-110"),p.style.borderColor="white"}),r.classList.add("ring-2","ring-orange-400","ring-offset-2","scale-110"),r.style.borderColor="transparent",w.setColor(r.dataset.color)};t.querySelectorAll(".color-btn").forEach(r=>{r.onclick=p=>E(p.currentTarget)});const L=t.querySelector(".color-btn");L&&E(L);const k=t.querySelector("#brush-size"),T=t.querySelector("#brush-size-value");k&&T&&(k.oninput=r=>{const p=parseInt(r.target.value);T.textContent=p,w.setBrushSize(p)});const v=t.querySelector("#mute-btn"),g=t.querySelector("#volume-slider"),A=()=>{const r=u.isMuted();v.textContent=r?"üîá":"üîä",g.disabled=r,g.classList.toggle("opacity-50",r)},S=t.querySelector("#music-selector");S.onchange=r=>{u.switchTrack(r.target.value)},g.oninput=r=>{u.setVolume(r.target.value/100)},v.onclick=()=>{u.mute(),A()},A(),g&&(g.value=u.getVolume()*100),S&&(S.value=u.getCurrentTrack()||"lofi")},j=()=>{if(!u.audio||!u.audio.paused)return;u.play();const n=()=>{u.audio&&u.audio.paused&&u.play(),["click","keydown","touchstart"].forEach(e=>document.removeEventListener(e,n,{capture:!0}))};["click","keydown","touchstart"].forEach(e=>document.addEventListener(e,n,{capture:!0}))},W=async()=>{try{const[n,e]=await Promise.all([fetch("/data/music.json"),fetch("/data/images.json")]);P.music=await n.json(),P.images=await e.json(),P.music.forEach(i=>{i.id!=="none"&&i.url&&u.addTrack(i.id,i.url)}),u.switchTrack("none");const t=B();t&&t.imageSrc?(t.audio?(t.audio.track&&u.switchTrack(t.audio.track),u.setVolume(t.audio.volume??.5),u.audio&&(u.audio.muted=!!t.audio.muted),t.audio.paused||j()):(!u.getCurrentTrack()||u.getCurrentTrack()==="default")&&u.switchTrack("none"),N(t.imageSrc,t.drawingData)):I(P.images)}catch(n){console.error("Failed to initialize app:",n)}};W();
